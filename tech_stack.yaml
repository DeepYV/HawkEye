highLevelPrinciples:
  mustBe:
    - "Invisible in customer apps (low overhead)"
    - "Deterministic (not ML-heavy early)"
    - "Explainable"
    - "Cheap to operate"
    - "Easy to integrate"
    - "Enterprise-ready later"
  optimizeFor: "Predictability > novelty"

components:
  frontendSDK:
    language: TypeScript
    frameworkSupport:
      react: true
      nextjs:
        appRouter: true
        pages: true
      frameworkAgnosticCore:
        type: DOM-based
        supported: true
    characteristics:
      sizeLimit: "<10KB gzipped"
      dependencies: "No dependencies where possible"
      runtime: "Browser only"
      buildTimePlugins: false
    rationale:
      - "First-class TS dev experience"
      - "Easy adoption"
      - "Tree-shaking"
      - "Good DX for OSS"

  eventTransport:
    protocol:
      primary: "HTTP (batched)"
      future: "WebSocket (optional)"
    format: JSON
    compression: Gzip
    rationale:
      - Reliable
      - "Easy debugging"
      - Firewall-friendly
      - "No infra surprises"
    avoid:
      - "gRPC in browser"
      - "Exotic protocols"

  backendCore:
    name: "Frustration Engine"
    language: Go
    rationale:
      - "Deterministic behavior"
      - "Low latency"
      - "High throughput"
      - "Easy concurrency"
      - "Simple mental model"
      - "Strong typing without complexity"

  apiLayer:
    framework:
      options:
        - net/http
        - chi
      preference: "Minimal middleware"
    rationale:
      - Predictable
      - Fast
      - "Easy to secure"
      - "No magic"
    avoid:
      - "Heavy frameworks"
      - "Over-abstracted REST layers"

  dataStorage:
    eventStorage:
      database: ClickHouse
      purpose: "Raw, short-lived event streams"
      retention: "7-30 days"
      rationale:
        - "Excellent for event streams"
        - "Cheap at scale"
        - "Fast aggregations"
        - "Perfect for session analysis"
    coreMetadata:
      database: PostgreSQL
      stores:
        - Projects
        - "API keys"
        - "Threshold configs"
        - "Incident records"
        - "Ticket mappings"
      rationale:
        - Reliable
        - ACID
        - Familiar
        - "Easy migrations"

  sessionProcessing:
    pattern: "Stream → Window → Evaluate → Emit"
    implementation: "In-process Go workers"
    evaluation: "Time-window evaluation"
    engine: "Deterministic rule engine"
    avoidEarly:
      - Kafka
      - Flink
      - Spark

  aiLLMLayer:
    stage: "Later stage"
    modelAccess:
      providers:
        - OpenAI
        - Anthropic
      accessMethod: API-based
    usagePattern:
      async: true
      postIncidentOnly: true
      neverInHotPath: true
    rationale:
      - "Keeps core system deterministic"
      - "Avoids latency & hallucination risk"

  integrations:
    approach: "Separate integration service"
    protocols:
      - Webhook
      - "REST APIs"
    targets:
      first: Linear
      future:
        - Jira

  infrastructure:
    cloud:
      options:
        - AWS
        - GCP
    components:
      compute: "Containers (ECS / GKE)"
      loadBalancer: true
      objectStorage: "Evidence blobs"
      secretsManager: true
    avoid: "Serverless for core processing (cold starts hurt trust)"

  observability:
    metrics:
      system: Prometheus
      visualization: Grafana
    logs:
      format: "Structured logs"
      correlation: "Correlation IDs per session"
    tracing: OpenTelemetry
    principle: "If you can't trust your system, customers won't"

security:
  mandatory:
    - "Field masking at SDK level"
    - "Encryption in transit"
    - "Encryption at rest"
    - "Configurable data retention"
  future:
    - "SOC2 readiness"
    - "GDPR delete hooks"
    - "Region-based data residency"